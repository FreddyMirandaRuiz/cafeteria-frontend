<div class="pos-wrapper">
  
  <div *ngIf="mostrarToast" class="toast-custom" [ngClass]="tipoMensaje">
    <span class="toast-icon">{{ tipoMensaje === 'success' ? '‚úÖ' : '‚ùå' }}</span>
    {{ mensaje }}
  </div>

  <div class="main-content">
    
    <div class="menu-side">
      <div class="header-search">
        <div class="brand-info">
          <h1>‚òï Delicias Peruanas</h1>
          <p class="mozo-badge">
            <span class="dot"></span> Mozo: <strong>{{ mozoNombre }}</strong>
          </p>
        </div>
        <div class="search-box">
          <input type="text" [(ngModel)]="filtroBusqueda" placeholder="Buscar producto (ej. Capuccino)...">
        </div>
      </div>

      <div class="products-grid custom-scroll">
        <div *ngFor="let p of productosFiltrados" class="product-card" (click)="agregarAlCarrito(p)">
          <div class="card-img">
			<img [src]="p.imagen ? 'http://localhost:8080/uploads/' + p.imagen : 'assets/default-food.png'"
			 (error)="manejarErrorImagen($event)" alt="producto">
            <span class="price-tag">S/ {{p.precio | number:'1.2-2'}}</span>
          </div>
          <div class="card-info">
            <span class="category-tag">{{ p.categoria }}</span>
            <h4>{{ p.nombre }}</h4>
          </div>
		  <div class="add-btn" (click)="agregarAlCarrito(p); $event.stopPropagation()">+</div>
        </div>
      </div>
    </div>

    <div class="cart-side">
      <div class="cart-card shadow">
        <div class="cart-header">
          <h3>Nueva Orden</h3>
          <div class="mesa-selector">
            <label>MESA</label>
            <input type="text" [(ngModel)]="nuevoPedido.mesa" maxlength="3" placeholder="00">
          </div>
        </div>

        <div class="cart-list custom-scroll">
          <div *ngIf="carrito.length === 0" class="empty-cart">
            <div class="empty-icon">üõí</div>
            <p>El carrito est√° vac√≠o</p>
          </div>

          <div *ngFor="let item of carrito; let i = index" class="cart-item">
            <div class="item-details">
              <strong>{{item.nombreProducto}}</strong>
              <span>S/ {{item.precio | number:'1.2-2'}}</span>
            </div>
            <div class="item-controls">
              <div class="qty-stepper">
				<button type="button" (click)="cambiarCantidad(i, -1); $event.stopPropagation()">-</button>
                <span>{{item.cantidad}}</span>
				<button type="button" (click)="cambiarCantidad(i, 1); $event.stopPropagation()">+</button>
              </div>
              <button (click)="quitarDelCarrito(i)" class="btn-remove">üóëÔ∏è</button>
            </div>
          </div>
        </div>

        <div class="cart-summary">
          <div class="summary-line"><span>Subtotal</span> <span>S/ {{montoSubtotal | number:'1.2-2'}}</span></div>
          <div class="summary-line"><span>IGV (18%)</span> <span>S/ {{montoIgv | number:'1.2-2'}}</span></div>
          <div class="total-line"><span>TOTAL</span> <span>S/ {{montoTotal | number:'1.2-2'}}</span></div>
          
          <button (click)="confirmarPedidoCompleto()" 
                  [disabled]="carrito.length === 0 || !nuevoPedido.mesa" 
                  class="btn-confirm">
            ENVIAR A COCINA
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="monitor-section">
    <div class="monitor-nav">
      <div class="tabs">
        <button [class.active]="filtroEstado === 'todos'" (click)="filtroEstado = 'todos'">Todos</button>
        <button [class.active]="filtroEstado === 'pendiente'" (click)="filtroEstado = 'pendiente'">‚è≥ Pendientes</button>
        <button [class.active]="filtroEstado === 'listo para servir'" (click)="filtroEstado = 'listo para servir'" class="btn-ready">
          üîî Listos ({{contadores.listo}})
        </button>
		<button [class.active]="filtroEstado === 'entregado'" (click)="filtroEstado = 'entregado'">‚úÖ Entregados</button>
      </div>
      <div class="stats">
        <small>Progreso de entregas</small>
        <div class="progress-bar"><div [style.width.%]="progresoAnimado"></div></div>
      </div>
    </div>

    <div class="table-card shadow">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Mesa</th>
            <th>Productos</th>
            <th>Monto</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of pedidosFiltrados" [class.ready-pulse]="p.estado === 'listo para servir'">
            <td><span class="mesa-badge-table">#{{p.mesa}}</span></td>
            <td class="resumen-text">{{p.productos}}</td>
            <td><strong>S/ {{p.total | number:'1.2-2'}}</strong></td>
            <td>
              <span class="status-pill" [ngClass]="p.estado">{{p.estado | titlecase}}</span>
            </td>
            <td>
              <div class="action-group">
                <button *ngIf="p.estado === 'listo para servir'" 
                        (click)="cambiarEstado(p, 'servido')" class="btn-action-serve">Servir</button>
				<button *ngIf="p.estado === 'servido'" 
						(click)="cambiarEstado(p, 'entregado')" class="btn-action-deliver">Finalizar</button>		
                <button (click)="eliminarPedido(p)" class="btn-action-delete">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>