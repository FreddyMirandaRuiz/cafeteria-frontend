<div class="container mt-5">
	<div class="card shadow-lg border-0 rounded-3">
	    
	    <!-- âœ… Header con color y diseÃ±o -->
	    <div class="card-header bg-primary bg-gradient text-white text-center py-3">
	      <h3 class="m-0">ðŸ“‹ Historial de Pedidos</h3>
	    </div>
		
		<div class="card-body">
			
			
  <input 
    type="text"
    [(ngModel)]="busqueda"
    (input)="filtrarPedidos()"
    class="form-control mb-4"
    placeholder="Buscar por mesa, mozo, fecha o estado..."
  />

  <table class="table table-striped table-hover align-middle text-center shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Mesa</th>
        <th>Mozo</th>
        <th>Fecha</th>
        <th>Total (S/)</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pedido of pedidosFiltrados">
        <td>{{ pedido.id }}</td>
        <td>{{ pedido.mesa }}</td>
        <td>{{ pedido.mozo }}</td>
        <td>{{ pedido.fecha | date: 'short' }}</td>
        <td>{{ pedido.total | number: '1.2-2' }}</td>
        <td>
          <span class="badge"
            [ngClass]="{
              'bg-success': pedido.estado === 'entregado',
              'bg-warning text-dark': pedido.estado === 'pendiente',
              'bg-info text-dark': pedido.estado === 'listo para servir',
              'bg-danger': pedido.estado === 'cancelado',
              'bg-secondary': pedido.estado === 'en preparaciÃ³n',
			  'badge-servido': pedido.estado === 'servido'
            }">
            {{ pedido.estado | titlecase }}
          </span>
        </td>
        <td>
          <button class="btn btn-info btn-sm" (click)="abrirModal(pedido)">
            Ver Detalles
          </button>
        </td>
      </tr>

      <tr *ngIf="pedidosFiltrados.length === 0">
        <td colspan="7" class="text-muted">No se encontraron pedidos.</td>
      </tr>
    </tbody>
  </table>

  <!-- ðŸªŸ Modal Detalles -->
  <div class="modal fade" id="modalDetalles" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Detalles del Pedido</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body" *ngIf="pedidoSeleccionado">
          <p><strong>Mesa:</strong> {{ pedidoSeleccionado.mesa }}</p>
          <p><strong>Mozo:</strong> {{ pedidoSeleccionado.mozo }}</p>
          <p><strong>Fecha:</strong> {{ pedidoSeleccionado.fecha | date:'medium' }}</p>
          <p><strong>Estado:</strong> {{ pedidoSeleccionado.estado | titlecase }}</p>

          <h5 class="mt-3">Productos</h5>
          <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
              <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio (S/)</th>
                <th>Subtotal (S/)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of getDetallesSeguro()">
                <td>{{ d.nombre }}</td>
                <td>{{ d.cantidad }}</td>
                <td>{{ d.precio | number:'1.2-2' }}</td>
                <td>{{ d.subtotal | number:'1.2-2' }}</td>
              </tr>

              <tr *ngIf="getDetallesSeguro().length === 0">
                <td colspan="4" class="text-muted">No hay productos en este pedido</td>
              </tr>
            </tbody>
          </table>

          <div class="text-end mt-3">
            <strong>Total:</strong>
            <span class="text-primary">S/ {{ pedidoSeleccionado.total | number:'1.2-2' }}</span>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button class="btn btn-primary" (click)="generarPDF()">Descargar Comprobante</button>
        </div>
      </div>
    </div>
  </div>
</div>