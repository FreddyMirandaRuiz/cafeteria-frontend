<div class="carrito-container">
  <div class="carrito-card">
    <h2 class="titulo">ğŸ§º Tu Carrito</h2>

    <table *ngIf="carrito.length > 0; else vacio" class="tabla-carrito">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of carrito">
          <td>{{ p.nombre }}</td>
          <td>{{ p.precio | currency: 'USD' }}</td>
          <td>{{ p.cantidad }}</td>
          <td>{{ p.precio * p.cantidad | currency: 'USD' }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #vacio>
      <p class="vacio">ğŸ›’ Tu carrito estÃ¡ vacÃ­o. <br />Â¡Agrega tus productos favoritos â˜•!</p>
    </ng-template>

	<div class="total-section" *ngIf="carrito.length > 0">
	  
	  <h4>Total: <span>{{ total | currency: 'USD' }}</span></h4>

	  <div class="botones-compra">
	    <button class="btn-cancelar" (click)="volverTienda()">
	      âŒ Cancelar
	    </button>

	    <button class="btn-finalizar" (click)="realizarCompra()">
	      âœ… Realizar compra
	    </button>
	  </div>

	</div>
  </div>
</div>

<!-- Modal de pago -->
<div class="modal fade" id="modalPago" tabindex="-1" aria-labelledby="modalPagoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalPagoLabel">ğŸ’³ Elige un mÃ©todo de pago</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-grid gap-2">
          <button 
		  class="btn btn-outline-success metodo-boton" 
		  [ngClass]="{ 'tarjeta-activa': metodoPago === 'tarjeta' }"
		  (click)="seleccionarMetodo('tarjeta')">ğŸ’³ Tarjeta</button>
		  
          <button 
		  class="btn btn-outline-primary metodo-boton" 
		  [ngClass]="{ 'yape-activo': metodoPago === 'yape' }"
		  (click)="seleccionarMetodo('yape')">ğŸ“± Yape</button>
		  
          <button 
		  class="btn btn-outline-info metodo-boton" 
		  [ngClass]="{ 'plin-activo': metodoPago === 'plin' }"
		  (click)="seleccionarMetodo('plin')">ğŸ’  Plin</button>
		  
        </div>
		
		<!-- ğŸ”¥ Mensaje de advertencia -->
		<div class="alerta-metodo" *ngIf="metodoPago === ''">
		  âš ï¸ Selecciona un mÃ©todo de pago para continuar
		</div>

		<div *ngIf="metodoPago === 'tarjeta'" class="mt-3" [formGroup]="formTarjeta">

		  <h6>Datos de la tarjeta</h6>

		  <!-- NÃºmero de tarjeta con icono dinÃ¡mico -->
		  <div class="input-group mb-2">
		    <input 
		      class="form-control"
		      placeholder="NÃºmero de tarjeta"
		      formControlName="numero"
		      (input)="formatearNumero()"
		    />
		    <span class="input-group-text">
		      <img *ngIf="iconoTarjeta" [src]="iconoTarjeta" width="30" />
		    </span>
		  </div>
		  <small class="text-danger" *ngIf="error('numero')">NÃºmero invÃ¡lido</small>

		  <!-- Titular -->
		  <input 
		    class="form-control mb-2"
		    placeholder="Titular"
		    formControlName="titular"
		  />
		  <small class="text-danger" *ngIf="error('titular')">Ingresa el nombre</small>

		  <!-- ExpiraciÃ³n -->
		  <input 
		    class="form-control mb-2"
		    placeholder="MM/AA"
		    formControlName="expiracion"
		    (input)="formatearExpiracion()"
		  />
		  <small class="text-danger" *ngIf="error('expiracion')">Fecha invÃ¡lida o expirada</small>

		  <!-- CVV -->
		  <input 
		    class="form-control mb-2"
		    placeholder="CVV"
		    formControlName="cvv"
		    [maxlength]="maxCVV"
		  />
		  <small class="text-danger" *ngIf="error('cvv')">CVV invÃ¡lido</small>

		</div>

        <div *ngIf="metodoPago === 'yape'" class="mt-3 text-center">
          <h6>Escanea el QR de Yape ğŸ“±</h6>
          <img src="assets/yape-qr.png" alt="Yape QR" class="img-fluid rounded shadow-lg" style="max-width: 250px;">
        </div>

        <div *ngIf="metodoPago === 'plin'" class="mt-3 text-center">
          <h6>Escanea el QR de Plin ğŸ’ </h6>
          <img src="assets/plin-qr.png" alt="Plin QR" class="img-fluid rounded shadow-lg" style="max-width: 250px;">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-success" 
		(click)="confirmarPago()"
		[disabled]="
		metodoPago === '' || 
		(metodoPago==='tarjeta' && formTarjeta.invalid)"
		>Finalizar compra âœ…</button>
      </div>
    </div>
  </div>
</div>