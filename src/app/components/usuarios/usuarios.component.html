<div class="container mt-4 pb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-dark mb-0">üë§ Gesti√≥n de Usuarios</h2>
      <p class="text-muted">Administra los accesos del personal</p>
    </div>
    <div class="card bg-primary text-white text-center p-2 shadow-sm" style="min-width: 150px;">
      <small>Total Registrados</small>
      <h3 class="fw-bold mb-0">{{ totalUsuarios }}</h3>
    </div>
  </div>

  <div class="card shadow-sm border-0 mb-4 bg-light">
    <div class="card-body p-4">
      <h5 class="card-title mb-3 text-primary">‚ûï Registrar Personal</h5>
      <form (ngSubmit)="registrar()" class="row g-3">
        <div class="col-md-3">
          <label class="form-label small fw-bold text-secondary">Nombre Completo *</label>
          <input [(ngModel)]="nuevoUsuario.nombre" name="nombre" class="form-control" placeholder="Ej: Juan P√©rez" required>
        </div>
        <div class="col-md-3">
          <label class="form-label small fw-bold text-secondary">Usuario *</label>
          <input [(ngModel)]="nuevoUsuario.usuario" name="usuario" class="form-control" placeholder="ID de acceso" required>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-bold text-secondary">Password *</label>
          <input [(ngModel)]="nuevoUsuario.password" name="password" type="password" class="form-control" placeholder="Min. 4 caracteres" required>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-bold text-secondary">Rol *</label>
          <select [(ngModel)]="nuevoUsuario.rol" name="rol" class="form-select" required>
            <option value="">Seleccionar...</option>
            <option value="ADMIN">ADMIN</option>
            <option value="CAJERO">CAJERO</option>
            <option value="MESERO">MESERO</option>
            <option value="COCINA">COCINA</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary w-100 shadow-sm py-2" [disabled]="!formularioValido() || cargando">
            <span *ngIf="!cargando">Guardar Usuario</span>
            <span *ngIf="cargando" class="spinner-border spinner-border-sm"></span>
          </button>
        </div>
      </form>
      <div class="mt-2 text-danger small" *ngIf="!formularioValido() && !cargando">
        * Todos los campos son obligatorios.
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="p-3 border-bottom bg-white rounded-top">
        <input type="text" [(ngModel)]="filtro" (input)="aplicarFiltro()" 
               class="form-control border-0 bg-light" placeholder="üîç Buscar por nombre o rol...">
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light text-secondary">
            <tr>
              <th class="ps-4 text-uppercase small fw-bold">Nombre</th>
              <th class="text-uppercase small fw-bold">Usuario</th>
              <th class="text-uppercase small fw-bold">Rol</th>
              <th class="text-center text-uppercase small fw-bold">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of usuariosFiltrados">
              <td class="ps-4">
                <div class="fw-bold">{{ u.nombre }}</div>
              </td>
              <td><code class="bg-light p-1 rounded">{{ u.usuario }}</code></td>
              <td>
                <span class="badge rounded-pill" 
                      [ngClass]="{'bg-danger': u.rol==='ADMIN', 'bg-success': u.rol==='CAJERO', 'bg-info': u.rol==='MESERO', 'bg-warning text-dark': u.rol==='COCINA'}">
                  {{ u.rol }}
                </span>
              </td>
              <td class="text-center">
                <button class="btn btn-outline-warning btn-sm border-0 me-1" (click)="abrirModal(u)">‚úèÔ∏è</button>
                <button class="btn btn-outline-danger btn-sm border-0" (click)="eliminar(u.id!)">üóë</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalEditarUsuario" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">‚úèÔ∏è Editar Usuario</h5>
        <button type="button" class="btn-close btn-close-white" (click)="cerrarModal()"></button>
      </div>
      <div class="modal-body p-4">
        <form>
          <div class="mb-3">
            <label class="form-label fw-bold">Nombre Completo</label>
            <input [(ngModel)]="usuarioEdit.nombre" name="editNombre" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">ID Usuario</label>
            <input [(ngModel)]="usuarioEdit.usuario" name="editUser" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Rol</label>
            <select [(ngModel)]="usuarioEdit.rol" name="editRol" class="form-select">
              <option value="ADMIN">ADMIN</option>
              <option value="CAJERO">CAJERO</option>
              <option value="MESERO">MESERO</option>
              <option value="COCINA">COCINA</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light">
        <button class="btn btn-link text-secondary text-decoration-none" (click)="cerrarModal()">Cancelar</button>
        <button class="btn btn-success px-4" (click)="guardarCambios()" 
                [disabled]="!usuarioEdit.nombre.trim() || !usuarioEdit.usuario.trim()">
          Guardar Cambios
        </button>
      </div>
    </div>
  </div>
</div>